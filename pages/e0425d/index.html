<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>《MySQL是怎么运行的》 | 北冥无鱼</title>
    <meta name="generator" content="VuePress 1.9.2">
    <link rel="icon" href="/img/tiger.png">
    <meta name="description" content="一个基于VuePress的 知识管理&amp;博客 主题">
    <meta name="keywords" content="vuepress,theme,blog,vdoing">
    <meta name="theme-color" content="#11a8cd">
    <meta name="referrer" content="no-referrer-when-downgrade">
    
    <link rel="preload" href="/assets/css/0.styles.95c3837a.css" as="style"><link rel="preload" href="/assets/js/app.346e1551.js" as="script"><link rel="preload" href="/assets/js/2.2bb1a3f0.js" as="script"><link rel="preload" href="/assets/js/28.4cd79971.js" as="script"><link rel="prefetch" href="/assets/js/10.941f9595.js"><link rel="prefetch" href="/assets/js/11.b7d791b9.js"><link rel="prefetch" href="/assets/js/12.ebbfbefa.js"><link rel="prefetch" href="/assets/js/13.55bee0ae.js"><link rel="prefetch" href="/assets/js/14.1e95b815.js"><link rel="prefetch" href="/assets/js/15.2d2eef87.js"><link rel="prefetch" href="/assets/js/16.39294289.js"><link rel="prefetch" href="/assets/js/17.743ca12b.js"><link rel="prefetch" href="/assets/js/18.50024288.js"><link rel="prefetch" href="/assets/js/19.cfa6e429.js"><link rel="prefetch" href="/assets/js/20.da3fce67.js"><link rel="prefetch" href="/assets/js/21.419116e7.js"><link rel="prefetch" href="/assets/js/22.6d444788.js"><link rel="prefetch" href="/assets/js/23.c331d239.js"><link rel="prefetch" href="/assets/js/24.f09ffbc2.js"><link rel="prefetch" href="/assets/js/25.954abaad.js"><link rel="prefetch" href="/assets/js/26.4a4aff6b.js"><link rel="prefetch" href="/assets/js/27.1aaac913.js"><link rel="prefetch" href="/assets/js/29.40208485.js"><link rel="prefetch" href="/assets/js/3.9cf196df.js"><link rel="prefetch" href="/assets/js/30.f3086bc0.js"><link rel="prefetch" href="/assets/js/31.8acc6cef.js"><link rel="prefetch" href="/assets/js/32.e9cde725.js"><link rel="prefetch" href="/assets/js/33.1ee5100f.js"><link rel="prefetch" href="/assets/js/34.e22db86e.js"><link rel="prefetch" href="/assets/js/35.4eafac50.js"><link rel="prefetch" href="/assets/js/36.1c1ee1f4.js"><link rel="prefetch" href="/assets/js/37.677fb893.js"><link rel="prefetch" href="/assets/js/38.9cd6536e.js"><link rel="prefetch" href="/assets/js/39.733cb66f.js"><link rel="prefetch" href="/assets/js/4.5d4b1e3e.js"><link rel="prefetch" href="/assets/js/40.c37b65b2.js"><link rel="prefetch" href="/assets/js/41.1f7a5823.js"><link rel="prefetch" href="/assets/js/42.d5d8d61c.js"><link rel="prefetch" href="/assets/js/43.0440be56.js"><link rel="prefetch" href="/assets/js/44.46973971.js"><link rel="prefetch" href="/assets/js/45.30b89f29.js"><link rel="prefetch" href="/assets/js/46.84eaf89e.js"><link rel="prefetch" href="/assets/js/47.0a145016.js"><link rel="prefetch" href="/assets/js/48.8c43259c.js"><link rel="prefetch" href="/assets/js/49.fa78dd64.js"><link rel="prefetch" href="/assets/js/5.7b963edb.js"><link rel="prefetch" href="/assets/js/50.84e3f3a9.js"><link rel="prefetch" href="/assets/js/51.477ee945.js"><link rel="prefetch" href="/assets/js/52.f118ef1f.js"><link rel="prefetch" href="/assets/js/53.a43cea39.js"><link rel="prefetch" href="/assets/js/54.24040505.js"><link rel="prefetch" href="/assets/js/55.48b7784e.js"><link rel="prefetch" href="/assets/js/56.d6fc5474.js"><link rel="prefetch" href="/assets/js/57.2be4b3b9.js"><link rel="prefetch" href="/assets/js/58.12e8eb95.js"><link rel="prefetch" href="/assets/js/59.11d2261d.js"><link rel="prefetch" href="/assets/js/6.cd22f69f.js"><link rel="prefetch" href="/assets/js/60.3ff6cfa9.js"><link rel="prefetch" href="/assets/js/61.21178592.js"><link rel="prefetch" href="/assets/js/62.1352608c.js"><link rel="prefetch" href="/assets/js/63.050641e9.js"><link rel="prefetch" href="/assets/js/64.d6d2d9e3.js"><link rel="prefetch" href="/assets/js/65.434963df.js"><link rel="prefetch" href="/assets/js/66.d0d97246.js"><link rel="prefetch" href="/assets/js/67.e329127c.js"><link rel="prefetch" href="/assets/js/68.7188bc65.js"><link rel="prefetch" href="/assets/js/69.868797a3.js"><link rel="prefetch" href="/assets/js/7.56bd88c1.js"><link rel="prefetch" href="/assets/js/70.fe5b1b21.js"><link rel="prefetch" href="/assets/js/71.f427eba0.js"><link rel="prefetch" href="/assets/js/72.8f3d4a59.js"><link rel="prefetch" href="/assets/js/73.a3c0ad82.js"><link rel="prefetch" href="/assets/js/74.4411d6f8.js"><link rel="prefetch" href="/assets/js/75.22170cc4.js"><link rel="prefetch" href="/assets/js/76.beca6f44.js"><link rel="prefetch" href="/assets/js/77.04a63c9c.js"><link rel="prefetch" href="/assets/js/78.a6f5f2b5.js"><link rel="prefetch" href="/assets/js/79.419b9cef.js"><link rel="prefetch" href="/assets/js/8.682d07e5.js"><link rel="prefetch" href="/assets/js/80.fea58868.js"><link rel="prefetch" href="/assets/js/81.5621bd89.js"><link rel="prefetch" href="/assets/js/82.64069ab7.js"><link rel="prefetch" href="/assets/js/83.37c14276.js"><link rel="prefetch" href="/assets/js/84.ae6c6209.js"><link rel="prefetch" href="/assets/js/85.b89b8c71.js"><link rel="prefetch" href="/assets/js/86.edc5934a.js"><link rel="prefetch" href="/assets/js/87.f9e215fa.js"><link rel="prefetch" href="/assets/js/88.40c5928c.js"><link rel="prefetch" href="/assets/js/89.be2ef4b1.js"><link rel="prefetch" href="/assets/js/9.f02c9057.js"><link rel="prefetch" href="/assets/js/90.8c27d903.js"><link rel="prefetch" href="/assets/js/91.1ede16f3.js"><link rel="prefetch" href="/assets/js/92.118ff1df.js"><link rel="prefetch" href="/assets/js/93.9773dab5.js"><link rel="prefetch" href="/assets/js/94.400d48d0.js"><link rel="prefetch" href="/assets/js/95.a2f813ab.js"><link rel="prefetch" href="/assets/js/96.ac3ab234.js">
    <link rel="stylesheet" href="/assets/css/0.styles.95c3837a.css">
  </head>
  <body class="theme-mode-light">
    <div id="app" data-server-rendered="true"><div class="theme-container sidebar-open have-rightmenu"><header class="navbar blur"><div title="目录" class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/img/tiger.png" alt="北冥无鱼" class="logo"> <span class="site-name can-hide">北冥无鱼</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><a href="/pages/e0425d/" aria-current="page" class="nav-link router-link-exact-active router-link-active">Java</a></div><div class="nav-item"><a href="/pages/7387ee/" class="nav-link">科研</a></div><div class="nav-item"><a href="/pages/db78e2/" class="nav-link">生活</a></div><div class="nav-item"><a href="/pages/4df89e/" class="nav-link">C++</a></div><div class="nav-item"><a href="/archives/" class="nav-link">归档</a></div> <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar-hover-trigger"></div> <aside class="sidebar" style="display:none;"><!----> <nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><a href="/pages/e0425d/" aria-current="page" class="nav-link router-link-exact-active router-link-active">Java</a></div><div class="nav-item"><a href="/pages/7387ee/" class="nav-link">科研</a></div><div class="nav-item"><a href="/pages/db78e2/" class="nav-link">生活</a></div><div class="nav-item"><a href="/pages/4df89e/" class="nav-link">C++</a></div><div class="nav-item"><a href="/archives/" class="nav-link">归档</a></div> <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Java基础</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>中间件</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>微服务</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>框架</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>数据库</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/c7801c/" class="sidebar-link">MySQL基础</a></li><li><a href="/pages/e0425d/" aria-current="page" class="active sidebar-link">《MySQL是怎么运行的》</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level2"><a href="/pages/e0425d/#第0章-楔子" class="sidebar-link">第0章 楔子</a></li><li class="sidebar-sub-header level2"><a href="/pages/e0425d/#第1章装作自己是个小白" class="sidebar-link">第1章	装作自己是个小白</a></li><li class="sidebar-sub-header level2"><a href="/pages/e0425d/#第2章启动选项和系统变量" class="sidebar-link">第2章	启动选项和系统变量</a></li><li class="sidebar-sub-header level2"><a href="/pages/e0425d/#第3章字符集和比较规则" class="sidebar-link">第3章	字符集和比较规则</a></li><li class="sidebar-sub-header level2"><a href="/pages/e0425d/#第4章innodb记录存储结构" class="sidebar-link">第4章	InnoDB记录存储结构</a></li><li class="sidebar-sub-header level2"><a href="/pages/e0425d/#第5章-innodb数据页结构" class="sidebar-link">第5章 InnoDB数据页结构</a></li><li class="sidebar-sub-header level2"><a href="/pages/e0425d/#第6章-b-树索引" class="sidebar-link">第6章 B+树索引</a></li><li class="sidebar-sub-header level2"><a href="/pages/e0425d/#第7章-b-树索引的应用" class="sidebar-link">第7章 B+树索引的应用</a></li><li class="sidebar-sub-header level2"><a href="/pages/e0425d/#第8章-数据的家" class="sidebar-link">第8章 数据的家</a></li><li class="sidebar-sub-header level2"><a href="/pages/e0425d/#第9章-innodb的表空间" class="sidebar-link">第9章 InnoDB的表空间</a></li><li class="sidebar-sub-header level2"><a href="/pages/e0425d/#第10章-单表访问方式" class="sidebar-link">第10章 单表访问方式</a></li><li class="sidebar-sub-header level2"><a href="/pages/e0425d/#第11章-连接的原理" class="sidebar-link">第11章 连接的原理</a></li><li class="sidebar-sub-header level2"><a href="/pages/e0425d/#第12章-基于成本的优化" class="sidebar-link">第12章 基于成本的优化</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/pages/e0425d/#成本" class="sidebar-link">成本</a></li><li class="sidebar-sub-header level3"><a href="/pages/e0425d/#基于成本的优化步骤" class="sidebar-link">基于成本的优化步骤</a></li><li class="sidebar-sub-header level3"><a href="/pages/e0425d/#基于索引统计数据的成本计算" class="sidebar-link">基于索引统计数据的成本计算</a></li><li class="sidebar-sub-header level3"><a href="/pages/e0425d/#连接查询的成本" class="sidebar-link">连接查询的成本</a></li><li class="sidebar-sub-header level4"><a href="/pages/e0425d/#条件过滤" class="sidebar-link">条件过滤</a></li><li class="sidebar-sub-header level4"><a href="/pages/e0425d/#两表连接的成本分析" class="sidebar-link">两表连接的成本分析</a></li><li class="sidebar-sub-header level4"><a href="/pages/e0425d/#多表连接的成本分析" class="sidebar-link">多表连接的成本分析</a></li><li class="sidebar-sub-header level3"><a href="/pages/e0425d/#调节成本常数" class="sidebar-link">调节成本常数</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/pages/e0425d/#第13章-innodb统计数据是如何收集的" class="sidebar-link">第13章 InnoDB统计数据是如何收集的</a></li><li class="sidebar-sub-header level2"><a href="/pages/e0425d/#第14章-基于规则的优化" class="sidebar-link">第14章 基于规则的优化</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/pages/e0425d/#一些简单的优化" class="sidebar-link">一些简单的优化</a></li><li class="sidebar-sub-header level3"><a href="/pages/e0425d/#常量表检测" class="sidebar-link">常量表检测</a></li><li class="sidebar-sub-header level3"><a href="/pages/e0425d/#外连接消除" class="sidebar-link">外连接消除</a></li><li class="sidebar-sub-header level3"><a href="/pages/e0425d/#子查询mysql执行过程" class="sidebar-link">子查询MySQL执行过程</a></li><li class="sidebar-sub-header level4"><a href="/pages/e0425d/#不相关标量子查询" class="sidebar-link">不相关标量子查询</a></li><li class="sidebar-sub-header level4"><a href="/pages/e0425d/#相关标量子查询" class="sidebar-link">相关标量子查询</a></li><li class="sidebar-sub-header level4"><a href="/pages/e0425d/#in子查询的优化" class="sidebar-link">IN子查询的优化</a></li><li class="sidebar-sub-header level4"><a href="/pages/e0425d/#将子查询转换为semi-join" class="sidebar-link">将子查询转换为semi-join</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/pages/e0425d/#第15章-explain详解" class="sidebar-link">第15章 EXPLAIN详解</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/pages/e0425d/#执行输出中各列" class="sidebar-link">执行输出中各列</a></li><li class="sidebar-sub-header level4"><a href="/pages/e0425d/#table" class="sidebar-link">table</a></li><li class="sidebar-sub-header level4"><a href="/pages/e0425d/#id" class="sidebar-link">id</a></li><li class="sidebar-sub-header level4"><a href="/pages/e0425d/#select-type" class="sidebar-link">select_type</a></li><li class="sidebar-sub-header level4"><a href="/pages/e0425d/#type" class="sidebar-link">type</a></li><li class="sidebar-sub-header level4"><a href="/pages/e0425d/#possible-keys和key" class="sidebar-link">possible_keys和key</a></li><li class="sidebar-sub-header level4"><a href="/pages/e0425d/#key-len" class="sidebar-link">key_len</a></li><li class="sidebar-sub-header level4"><a href="/pages/e0425d/#ref" class="sidebar-link">ref</a></li><li class="sidebar-sub-header level4"><a href="/pages/e0425d/#rows" class="sidebar-link">rows</a></li><li class="sidebar-sub-header level4"><a href="/pages/e0425d/#filtered" class="sidebar-link">filtered</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/pages/e0425d/#第16章-optimizer-trace的神奇功效" class="sidebar-link">第16章 optimizer trace的神奇功效</a></li><li class="sidebar-sub-header level2"><a href="/pages/e0425d/#第17章-innodb的buffer-pool" class="sidebar-link">第17章 InnoDB的Buffer Pool</a></li><li class="sidebar-sub-header level2"><a href="/pages/e0425d/#第18章-事务" class="sidebar-link">第18章 事务</a></li><li class="sidebar-sub-header level2"><a href="/pages/e0425d/#第19章-redo日志" class="sidebar-link">第19章 redo日志</a></li><li class="sidebar-sub-header level2"><a href="/pages/e0425d/#第20章-undo日志" class="sidebar-link">第20章 undo日志</a></li><li class="sidebar-sub-header level2"><a href="/pages/e0425d/#第21章-事务隔离级别和mvcc" class="sidebar-link">第21章 事务隔离级别和MVCC</a></li><li class="sidebar-sub-header level2"><a href="/pages/e0425d/#第22章-锁" class="sidebar-link">第22章 锁</a></li></ul></li><li><a href="/pages/e60c12/" class="sidebar-link">MySQL函数</a></li><li><a href="/pages/c38f55/" class="sidebar-link">MySQL易忘点</a></li><li><a href="/pages/8d8ba3/" class="sidebar-link">锁</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>项目记录</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>秋招</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <div><main class="page"><div class="theme-vdoing-wrapper "><div class="articleInfo-wrap" data-v-06225672><div class="articleInfo" data-v-06225672><ul class="breadcrumbs" data-v-06225672><li data-v-06225672><a href="/" title="首页" class="iconfont icon-home router-link-active" data-v-06225672></a></li> <li data-v-06225672><span data-v-06225672>Java</span></li><li data-v-06225672><span data-v-06225672>数据库</span></li></ul> <div class="info" data-v-06225672><div title="作者" class="author iconfont icon-touxiang" data-v-06225672><a href="https://github.com/lzxiaohuihui" target="_blank" title="作者" class="beLink" data-v-06225672>Wenli</a></div> <div title="创建时间" class="date iconfont icon-riqi" data-v-06225672><a href="javascript:;" data-v-06225672>2023-03-03</a></div> <!----></div></div></div> <!----> <div class="content-wrapper"><div class="right-menu-wrapper"><div class="right-menu-margin"><div class="right-menu-title">目录</div> <div class="right-menu-content"></div></div></div> <h1><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAABKFJREFUSA3tVl1oFVcQnrMbrak3QUgkya1akpJYcrUtIqW1JvFBE9LiQ5v6JmJpolbMg32rVrhgoYK0QiMY6i9Y6EMaW5D+xFJaTYItIuK2Kr3+BJNwkxBj05sQY3b3nM6cs2dv9t7NT/vQJw/sndk5M/PNzJkzewGerP+pAmy+ON8lLzUJgA8ZYxYIYZmGYRnctDaWvJJAmTtfP1pvXsBCCPP8QFcCaRkZYACgDZFO4stNIcBCajEOlmmC9XpJ9bAGCaPaPmzPl32dvLSVu3BWCTQs0XQQ6g0DYgwLIoAZbBCdW/i+781o1VVlm/410mw4h06Y7bIPHNyWDyL4FHkX03Q8SrzNhZTZriieckWt7cL6MM85YcLpsi/7O9/iXFT6MswI0DmmpkSaJ0qLxFIm3+i1THHB3zmBH3PYx9CcykcLOeQVVa7QtdxTgQgEleX2AjHYfwA+2ddV77ruGoJUbhGDI09YSNXyMpUt5ylOzxgbUmtOp7NmbNt8v3arjTBfYELmLUV+M+nSawNNAUqpT3ClJWg5I3BLT+cGW/DXNGCa6tx1aakCGEigArTn4TDIPdrXXYKCZNrHLMCOEPvHBlLQ99s9eHB7EB6NTki73CVPQ2F5MSx/uRQixfmq7rK0wYD8w8E905bnPDfwoWs/rfv93NWN/ZfvwsLIU7A09gxECyISeGJkHAau98L97tuw7NXnoPyNF8FcYGLGKsOs0mN3OEyec9esGW/ZEl945dTP34wlR2FZVQWU1q0Cw8Tr7p+hgLLNL0FPxx/Q35mA8aEUrH6nCgwEl0tn7wUiZYJnNRh6DK4UH/k0lfyrsBKdPVv/AriGIQcEDQZ65LBAGe2Rzui9Ybjz7XUppz1/uKBbyVPGkN3ZAeC6hr0x7Nr38N5+EqkoOm17xpoqR9ohQF55ERSvr4Dkr3chNfC3DMzGJlNBElW8w9nsGQvhNGIzDkXzCg8cLK951xHsFBlTJspJNi3ZFIMF2AeDV3q8DNOB+YHi6QTrChDIWDBRi5U5f+ZMfJLu3ccrqxtdxk4SKH336LFxSmkqefwU5T8fhdSdQf9IVKD6aNiwI/hnmcAZ91isYMJIaCUCx9W098+LgruikeTqzqqxKPUwqJyCPJiyemVVZBOijDGjD38Os0jOiSPL1z3SPjXNANbiNPXAdzTfukjjuknNBbyz3nwgTd3AVFqUJ5hpHlq9MveLnWwttUfoygBmvVjuikxND3znrhsELnZk7k+OjIGxeNEkomyLVta0xxn+HZhjBc4YZ/AFjHjz9u3xRZl2BN4aq9nFwWh16IrQ1aHHEd3j1+4/dB9OtH4e29A2H1DyHQRmOSfQZ1Fy7MHBTGB6J/Djq6p3OxyO2cB+4Car7v/o3GXgfAkj23+x9ID1Teoamo/SXcbvSf2PX7Vc8DdCmE1vN9di+32P9/5YR3vLnhCVGUWBjEkr3yh4H8v9CzmsbdhzOKzsJKM90iFdaTMjRPhGVsakRvOaRidljo6H6G7j+ctrJpsP+4COhDIl0La2+FS4+5mlocBaXY5QnGZysIBYoeSsl5qQzrSj/cgNrfuEzlWBfwA+EjrZyWUvpAAAAABJRU5ErkJggg==">《MySQL是怎么运行的》<!----></h1>  <div class="theme-vdoing-content content__default"><p>都说这本书好，我倒要去看看</p> <h2 id="第0章-楔子"><a href="#第0章-楔子" class="header-anchor">#</a> 第0章 楔子</h2> <p>叫我逐章学习，不要跳着阅读</p> <h2 id="第1章装作自己是个小白"><a href="#第1章装作自己是个小白" class="header-anchor">#</a> 第1章	装作自己是个小白</h2> <p>介绍了一番MySQL客户端，服务器模式，客户端连接服务器方式。</p> <p>服务器处理客户端请求，具体步骤和MySQL执行过程一样。<a href="/pages/c7801c/">MySQL执行流程</a></p> <h2 id="第2章启动选项和系统变量"><a href="#第2章启动选项和系统变量" class="header-anchor">#</a> 第2章	启动选项和系统变量</h2> <p>没看</p> <h2 id="第3章字符集和比较规则"><a href="#第3章字符集和比较规则" class="header-anchor">#</a> 第3章	字符集和比较规则</h2> <p><strong>字符集</strong></p> <p>我们知道，计算机中实际存储的是二进制数据，那它是怎么存储字符串呢？当然是建立字符与二进制数据的映射关系了。</p> <ul><li>把哪些字符映射成二进制数据</li> <li>字符映射到二进制数据叫编码，反之叫解码</li></ul> <p><strong>比较规则</strong></p> <p>不区分大小写，全部转为大写或者小写</p> <p><strong>MySQL中的字符集</strong></p> <ul><li><strong>utf8mb3</strong>: “阉割”过的utf8，使用1-3字节表示字符；</li> <li><strong>utf8ub4</strong>: 正宗的utf8，使用1-4字节表示字符。</li></ul> <p><strong>MySQL中的比较规则</strong></p> <ul><li><strong>utf8_general_ci</strong>: ci（case insensitive）不区分大小写。</li></ul> <h2 id="第4章innodb记录存储结构"><a href="#第4章innodb记录存储结构" class="header-anchor">#</a> 第4章	InnoDB记录存储结构</h2> <p>页是InnoDB中磁盘和内存交互的基本单位，也是InnoDB管理存储空间的基本单位，默认大小为16KB。也就是说，一次从磁盘中读取内容到内存中是16KB，从内容写到磁盘，也是16KB。</p> <p><strong>COMPACT行格式（额外信息，真实数据）</strong></p> <table><thead><tr><th></th> <th style="text-align:center;">变长字段长度列表</th> <th style="text-align:center;">NULL值列表</th> <th style="text-align:center;">记录头信息</th> <th>列1的值</th> <th>列2的值</th> <th>...</th> <th>列n的值</th></tr></thead> <tbody><tr><td>记录1</td> <td style="text-align:center;">01 03 04</td> <td style="text-align:center;">00</td> <td style="text-align:center;"></td> <td></td> <td></td> <td></td> <td></td></tr> <tr><td>记录2</td> <td style="text-align:center;">03 04</td> <td style="text-align:center;">06</td> <td style="text-align:center;"></td> <td></td> <td></td> <td></td> <td></td></tr></tbody></table> <p><strong>变长字段长度列表</strong></p> <table><thead><tr><th style="text-align:center;">列名</th> <th style="text-align:center;">存储内容</th> <th style="text-align:center;">内容长度（十六进制）</th></tr></thead> <tbody><tr><td style="text-align:center;">c1</td> <td style="text-align:center;">'aaaa'</td> <td style="text-align:center;">0x04</td></tr> <tr><td style="text-align:center;">c3</td> <td style="text-align:center;">'bbb'</td> <td style="text-align:center;">0x03</td></tr> <tr><td style="text-align:center;">c4</td> <td style="text-align:center;">'d'</td> <td style="text-align:center;">0x01</td></tr></tbody></table> <p>那么就逆序存储变长字段的长度</p> <p><strong>NULL值列表</strong></p> <p>如果一个表中有9个值允许为NULL的列，则这个记录的NULL值列表部分需要2个字节表示，这个数据中的每一位代表真实数据是否为NULL。</p> <p>如c3, c4位NULL，则值位0x110  也就是06。</p> <h2 id="第5章-innodb数据页结构"><a href="#第5章-innodb数据页结构" class="header-anchor">#</a> 第5章 InnoDB数据页结构</h2> <p>页是InnoDB管理存储空间的基本单位，一个页的大小一般是16KB。InnoDB为了不同的目的设计了多种不同类型的页，这里介绍存放记录的页，数据页（索引页）。</p> <p><strong>InnoDB数据页结构</strong></p> <table><thead><tr><th style="text-align:center;">名称</th> <th style="text-align:center;">中文名</th> <th style="text-align:center;">占用空间大小</th> <th style="text-align:left;">简单描述</th></tr></thead> <tbody><tr><td style="text-align:center;">File Header</td> <td style="text-align:center;">文件头部</td> <td style="text-align:center;">38字节</td> <td style="text-align:left;">页的一些通用信息</td></tr> <tr><td style="text-align:center;">Page Header</td> <td style="text-align:center;">页面头部</td> <td style="text-align:center;">56字节</td> <td style="text-align:left;">数据页专有的一些信息</td></tr> <tr><td style="text-align:center;">Infimum + Supremum</td> <td style="text-align:center;">页面中的最小记录和最大记录</td> <td style="text-align:center;">26字节</td> <td style="text-align:left;">两个虚拟的记录</td></tr> <tr><td style="text-align:center;">User Records</td> <td style="text-align:center;">用户记录</td> <td style="text-align:center;">不确定</td> <td style="text-align:left;">用户存储的记录内容</td></tr> <tr><td style="text-align:center;">Free Space</td> <td style="text-align:center;">空闲空间</td> <td style="text-align:center;">不确定</td> <td style="text-align:left;">页中尚未使用的空间</td></tr> <tr><td style="text-align:center;">Page Directory</td> <td style="text-align:center;">页目录</td> <td style="text-align:center;">不确定</td> <td style="text-align:left;">页中某些记录的相对位置</td></tr> <tr><td style="text-align:center;">File Trailer</td> <td style="text-align:center;">文件尾部</td> <td style="text-align:center;">8字节</td> <td style="text-align:left;">校验页是否完整</td></tr></tbody></table> <p><strong>用户记录</strong></p> <p>我们自己存储的数据一开始在Free Space部分，随后将这部分划分到User Records中，当Free Space全部用完时，代表这个页使用完了。如果有新的记录插入，就需要去申请新的页了。</p> <p>上一章的行记录格式中的 记录头信息</p> <p><img src="https://lzh-images.oss-cn-hangzhou.aliyuncs.com/images/image-20230307204629091.png" alt="image-20230307204629091"></p> <p><strong>记录头信息</strong></p> <table><thead><tr><th>名称</th> <th>大小(比特〕</th> <th>描述</th></tr></thead> <tbody><tr><td>预留位 1</td> <td>1</td> <td>没有使用</td></tr> <tr><td>预留位 2</td> <td>1</td> <td>没有使用</td></tr> <tr><td>deleted_flag</td> <td>1</td> <td>标记该记录是否被删除</td></tr> <tr><td>min_rec_flag</td> <td>1</td> <td>B+ 树中每层非叶子节点中的 最小的目录项记录都会添加该标记</td></tr> <tr><td>n_owned</td> <td>4</td> <td>一个页面中的记录会被分成若干个组,每个组中有一个记录是&quot;带头大哥其余的记录都是&quot;小弟&quot;，&quot;带头大哥&quot;记录的 n_owned值代表该组中所有的记录条数，&quot;小弟&quot;记录的 n_owned 值都为 0</td></tr> <tr><td>heap_no</td> <td>13</td> <td>表示当前记录在页面堆中的相对位置</td></tr> <tr><td>record_type</td> <td>3</td> <td>表示当前记录的类型 。0 表示普通记录，1 表示 B+ 树非叶节点的目录项记录 . 2 表示 Infimum 记录 ，3 表示 Supremum 记录</td></tr> <tr><td>next record</td> <td>16</td> <td>表示下一条记录的相对位置</td></tr></tbody></table> <p><strong>页目录</strong></p> <p><img src="https://lzh-images.oss-cn-hangzhou.aliyuncs.com/images/image-20230307205916426.png" alt="image-20230307205916426"></p> <p>要找主键值为x的记录，通过二分法确定该记录所在分组对应的槽，然后找到该槽所在分组中主键值最小的那条记录，然后通过记录的next_record属性遍历该槽所在的组中的各个记录。</p> <p><strong>页面的头部</strong></p> <p>存储数据页中的记录状态信息，比如数据页中已经存储了多少条记录、Free Space在页面中的地址偏移量、页目录中存储了多少个槽等。</p> <p><strong>文件头部</strong></p> <p>存放各种页的信息，比如这个页的编号是多少，上一页下一页是谁。</p> <p><strong>文件尾部</strong></p> <ul><li>前4字节代表页的校验和，验证该页是否完整</li> <li>后4字节代表页面被最后修改时对应的LSN的后4字节</li></ul> <p><strong>总结</strong></p> <p>每个记录的头信息中都有一个 next record 属性 ,从而可以 使页 中的 所有记录串联成一个单向链表.</p> <p>lnnoDB 会把页中的记录划分为若干个组,每个组的最后一个记录的地址偏移量作为一个槽,存放在 Page Directory 中一个槽占用 2 字节.在一个页中根据主键查找记录是非常快的,分为两步.</p> <ol><li><p>通过 二分法确定该记录所在分 组对应的槽,并找到该糟所在分组中主键值最小的那条记录。</p></li> <li><p>通过记录的 next record 属性遍历该槽所在的组中 的各个记录.每个数据页的 File Header 部分 都有上 一个页和下一个页的编号,所以所有的数据页会组成一个双向链表。</p></li></ol> <p>在将页从内存刷新到磁盘时 , 为了保证页的完整性 ,<strong>页首</strong> 和 **页尾 **都会存储页中数据的校验和，以及页面最 后修改时对应 的 LSN 值 (页尾只会存 储 LSN 值的后 4 字节) . 如果页首和页尾的校验和以及 LSN 值校验不成功 , 就说明刷新期间出现了问题。</p> <h2 id="第6章-b-树索引"><a href="#第6章-b-树索引" class="header-anchor">#</a> 第6章 B+树索引</h2> <p>各个数据页可以组成一个双向链表，数据页中每条记录会按照主键值从小到大组成一个单向链表。每个数据页会生成一个页目录，通过页目录二分法找到对应的槽，再去顺序遍历槽对应的分组中的记录。</p> <p><img src="https://lzh-images.oss-cn-hangzhou.aliyuncs.com/images/image-20230308202801686.png" alt="image-20230308202801686"></p> <p>存放页目录的页，复用原来的数据页，所以记录中的记录头信息<strong>record_type</strong>，用来标记是用户记录还是目录项。存放页目录的页，中的记录只存放两个值，<strong>主键值</strong>与对应的<strong>页号</strong>。</p> <p><img src="https://lzh-images.oss-cn-hangzhou.aliyuncs.com/images/image-20230308203151282.png" alt="image-20230308203151282"></p> <p><strong>聚簇索引</strong></p> <p>使用记录主键值的大小进行记录和页的排序</p> <ol><li>页内的节点按照主键值大小排成一个单向链表，页内的节点分成若干个组，每组中最大主键值当成一个槽；</li> <li>存放页目录的页，根据主键值大小排成双向链表；</li> <li>存放用户记录的页，根据主键值大小排成双向链表；</li></ol> <p>B+树的叶子节点存储的是完整的用户记录。</p> <p><strong>二级索引</strong></p> <p>存放页目录的页中的记录只存放多个值，<strong>主键值</strong>，<strong>索引值</strong>与对应的<strong>页号</strong>。叶子节点包含<strong>索引值</strong>与<strong>主键值</strong>，再生成一颗B+树，但叶子节点不包含完整记录，找到叶子节点对应的主键值，再到主键索引中查找完整记录，需要进行一次<strong>回表</strong>操作；</p> <p><strong>联合索引</strong></p> <p>存放页目录的页中的记录只存放多个值，<strong>主键值</strong>，<strong>n个索引值</strong>与对应的<strong>页号</strong>。</p> <p><strong>MyISAM中的索引，都是二级索引，其它类似</strong>。</p> <h2 id="第7章-b-树索引的应用"><a href="#第7章-b-树索引的应用" class="header-anchor">#</a> 第7章 B+树索引的应用</h2> <p>​    每个索引都对应一颗B+树。B+树分为好多层，最下边一层是叶子节点，其余是内节点。所有用户记录都存储在B+树的叶子结点，所有目录项记录都存储在内节点。</p> <p>​	InnoDB存储引擎会自动为主键简历聚簇索引，聚簇索引的叶子节点包含<strong>完整</strong>的用户记录。但是建立的二级索引中的叶子节点只包含主键和索引列，若需要查找到非索引列，则需要拿到主键值，到聚簇索引中再查找一次，简称<strong>回表</strong>。</p> <p><strong>聚簇索引和二级索引示意图</strong></p> <p><img src="https://lzh-images.oss-cn-hangzhou.aliyuncs.com/images/image-20230322161110750.png" alt="image-20230322161110750"></p> <p><img src="https://lzh-images.oss-cn-hangzhou.aliyuncs.com/images/image-20230322161145982.png" alt="image-20230322161145982"></p> <p><strong>扫描区间和边界条件分析</strong></p> <p><strong>索引在空间和时间上都会“拖后腿”</strong></p> <ul><li>空间上的代价</li></ul> <p>​		每建立一个索引，都要为它建立一颗B+树。每一颗B+树的每一个节点都是一个数据页（一个节点中包含多条记录，还包含一些其它信息）。</p> <ul><li><p>时间上的代价</p> <p>因为索引列的值是有序的关系，如果新插入的数据，有可能会造成页面分裂、页面回收、还要维护索引列中的排序关系。</p> <p>在执行查询语句前，首先要生成一个执行计划。MySQL会分析使用不同索引执行查询所需要的成本，索引越多分析的时间越长。</p></li></ul> <p><strong>扫描区间和边界分析</strong></p> <p>去翻书吧。</p> <p><strong>更好的创建索引和使用索引</strong></p> <ol><li>只为用于搜索、排序或分组的列创建索引</li> <li>考虑索引列中不重复值的个数</li> <li>索引列的类型尽量小</li> <li>为列前缀建立索引，节省空间</li> <li>索引覆盖，只查询索引列，避免回表</li> <li>让索引列以列名的形式在搜索条件中单独出现</li></ol> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> single_table <span class="token keyword">where</span> key2 <span class="token operator">*</span> <span class="token number">2</span> <span class="token operator">&lt;</span> <span class="token number">4</span><span class="token punctuation">;</span>  <span class="token comment">#不适用索引，全表扫描</span>
<span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> single_table <span class="token keyword">where</span> key2  <span class="token operator">&lt;</span> <span class="token number">4</span><span class="token operator">/</span><span class="token number">2</span><span class="token punctuation">;</span>   
</code></pre></div><ol start="7"><li>新插入记录时主键大小对效率的影响，忽大忽小的插入可能会造成页面分裂</li></ol> <h2 id="第8章-数据的家"><a href="#第8章-数据的家" class="header-anchor">#</a> 第8章 数据的家</h2> <p>MySQL 服务器程序在启动时会到数据目录中加载数据,运行过程中产生的数据也会被存储到数据目录中系统变量也扭曲表明了数据目录的路径。</p> <p>每个数据库都对应着数据目录下的一个子目录，该子目录中包含一个名为 db.opt 的文件这个文件包含了该数据库的一些属性，比如该数据库的字符集和比较规则等。</p> <p>对于InnoDB 存储引擎来说 :</p> <ul><li>如果使用系统表空间存储表中的数据,那么只会在该表所在数据库对应的子目录下创建一个名为&quot;表名 frm&quot; 的文件,表中的数据会存储在系统表空间对应的文件中；</li> <li>如果使用独立表空间存储表中的数据，那么会在该表所在数据库对应的子目录下创建一个名为&quot;表名.frm&quot;的文件和一个名为&quot;表名.idb&quot;的文件，表中的数据会存储这个&quot;表名.idb&quot;文件中。</li></ul> <h2 id="第9章-innodb的表空间"><a href="#第9章-innodb的表空间" class="header-anchor">#</a> 第9章 InnoDB的表空间</h2> <h2 id="第10章-单表访问方式"><a href="#第10章-单表访问方式" class="header-anchor">#</a> 第10章 单表访问方式</h2> <h2 id="第11章-连接的原理"><a href="#第11章-连接的原理" class="header-anchor">#</a> 第11章 连接的原理</h2> <p>​	从本质上说，连接就是将多个表的数据查询出来依次匹配，组成一个结果集返回。如果没有过滤条件，产生的结果集那么就是笛卡尔积。</p> <p>​	MySQL中分为内连接和外连接，内连接也就是取匹配中的交集，外连接就是，被驱动表中有没有数据匹配与驱动表匹配，都保留驱动表中的数据，内连接则不保存。</p> <p>​	嵌套循环连接算法是值驱动表只访问一次，对于每一条驱动表中的数据，都会访问一次被驱动表。因此设计了Join Buffer（连接缓冲区）存放于内存，把驱动表中查询出来的数据放到缓冲区中，然后对于查询被驱动表中的每一条数据，都与缓冲区中的数据进行匹配。这样，就假如缓冲区足够大，那么只需访问一次被驱动表。</p> <h2 id="第12章-基于成本的优化"><a href="#第12章-基于成本的优化" class="header-anchor">#</a> 第12章 基于成本的优化</h2> <h3 id="成本"><a href="#成本" class="header-anchor">#</a> 成本</h3> <ul><li>I/O成本：当查询表中的记录时，需要把数据或者索引加载到内存中，然后再进行操作。这个从磁盘到内存的加载过程损耗的时间成为I/O成本。</li> <li>CPU成本：读取记录以及检测记录是否满足对应的搜索条件、对结果集进行排序等这些操作损耗的时间称为CPU成本。</li></ul> <p>对于InnoDB存储引擎来说，读取一个页面花费的成本默认是1.0；读取以及检测一条记录是否符合搜索条件的成本默认是0.2。</p> <h3 id="基于成本的优化步骤"><a href="#基于成本的优化步骤" class="header-anchor">#</a> 基于成本的优化步骤</h3> <ol><li>根据搜索条件，找出所有可能使用的索引</li> <li>计算全表扫描的代价</li> <li>计算使用不同索引执行查询的代价</li> <li>对比各种执行方案的代价，找出成本最低的那个方案</li></ol> <h3 id="基于索引统计数据的成本计算"><a href="#基于索引统计数据的成本计算" class="header-anchor">#</a> 基于索引统计数据的成本计算</h3> <p>每张表都有一个对应的统计表，来记录这张表的信息。比如有个索引统计数据，index statistics，<code>show index from 表名</code>，统计索引列中的各种信息，有一个比较重要的信息，<code>Cardinality</code>，表示该列中不重复值的数量。根据这个属性，可以计算出在某一列中一个值平均出现了多少次，大约重复次数等于函数初一<code>Cardinality</code>值。</p> <h3 id="连接查询的成本"><a href="#连接查询的成本" class="header-anchor">#</a> 连接查询的成本</h3> <h4 id="条件过滤"><a href="#条件过滤" class="header-anchor">#</a> 条件过滤</h4> <p>因为在连接查询中，驱动表会被访问一次，被驱动表可能会被访问多次。所以，对于两表连接查询来说，它的查询成本由两部分构成：</p> <ul><li>单词查询驱动表的成本</li> <li>多次查询被驱动表的成本</li></ul> <p>驱动表的记录条数成为扇出（fanout），然后呢，就要计算扇出值。</p> <p>对于那些条件中没有使用的索引列的数据，完全靠猜测来计算符合条件的记录条数，对于有索引列，那么通过<code>Cardinality</code>来猜测条数。</p> <h4 id="两表连接的成本分析"><a href="#两表连接的成本分析" class="header-anchor">#</a> 两表连接的成本分析</h4> <p>连接查询的总成本=单词访问驱动表的成本 + 驱动表的扇出值*单词访问被驱动表的成本</p> <p>所以也需要考虑最优的表连接顺序，优化的重点就是后面那个大头：</p> <ul><li>尽量减少驱动表的扇出值</li> <li>访问被驱动表的成本要尽量底</li></ul> <h4 id="多表连接的成本分析"><a href="#多表连接的成本分析" class="header-anchor">#</a> 多表连接的成本分析</h4> <p>n张表的连接方式就有n!种连接方式，通过一些启发式规则来分析多表连接的成本，比如</p> <ul><li>提前结束某种连接顺序的成本评估</li> <li>防止无穷无尽地分析各种连接顺序的成本，只分析小于一定的连接表数量</li></ul> <h3 id="调节成本常数"><a href="#调节成本常数" class="header-anchor">#</a> 调节成本常数</h3> <p>有两张表，<code>engine_cost</code>，<code>server_cost</code></p> <p>在server层进行连接管理、查询缓存、语法解析、查询优化等操作；</p> <p>在存储引擎层执行具体的数据存取操作。</p> <h2 id="第13章-innodb统计数据是如何收集的"><a href="#第13章-innodb统计数据是如何收集的" class="header-anchor">#</a> 第13章 InnoDB统计数据是如何收集的</h2> <h2 id="第14章-基于规则的优化"><a href="#第14章-基于规则的优化" class="header-anchor">#</a> 第14章 基于规则的优化</h2> <h3 id="一些简单的优化"><a href="#一些简单的优化" class="header-anchor">#</a> 一些简单的优化</h3> <ul><li>移除不必要的括号</li> <li>常量传递</li></ul> <div class="language-sql extra-class"><pre class="language-sql"><code>a <span class="token operator">=</span> <span class="token number">5</span> <span class="token operator">AND</span> b <span class="token operator">&gt;</span> a
</code></pre></div><div class="language-sql extra-class"><pre class="language-sql"><code>a <span class="token operator">=</span> <span class="token number">5</span> <span class="token operator">AND</span> b <span class="token operator">&gt;</span> <span class="token number">5</span>
</code></pre></div><ul><li><p>等值传递</p></li> <li><p>移除没用的条件</p></li> <li><p>表达式计算</p></li> <li><p>HAVING字句和WHERE字句的合并，如果没用出现SUM、MAC等聚集函数以及GROUP BY字句，优化器就把HAVING字句和WHERE字句合并</p></li></ul> <h3 id="常量表检测"><a href="#常量表检测" class="header-anchor">#</a> 常量表检测</h3> <p>这两种查询话费的时间特别少</p> <ul><li>查询的表中一条记录没有，或者只有一条记录（根据统计信息（但不准确））</li> <li>使用主键等值匹配或者唯一二级索引列等值匹配</li></ul> <h3 id="外连接消除"><a href="#外连接消除" class="header-anchor">#</a> 外连接消除</h3> <p>在被驱动表中没有找到符合条件的记录，就会加入一条NULL值的记录到结果集中。如果在where条件中拒绝空值，这时候的查询结果是等价于内连接的，那么就可以将外连接转换为内连接。</p> <p>转为内连接的好处是，优化器可以评估不同连接顺序的成本，进而选出成本最低的那种连接顺序进行查询。</p> <h3 id="子查询mysql执行过程"><a href="#子查询mysql执行过程" class="header-anchor">#</a> 子查询MySQL执行过程</h3> <h4 id="不相关标量子查询"><a href="#不相关标量子查询" class="header-anchor">#</a> 不相关标量子查询</h4> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> s1 
    <span class="token keyword">WHERE</span> key1 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">SELECT</span> common_field <span class="token keyword">FROM</span> s2 <span class="token keyword">WHERE</span> key3 <span class="token operator">=</span> <span class="token string">'a'</span> <span class="token keyword">LIMIT</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><ul><li>先单独执行子查询<code>SELECT common_field FROM s2 WHERE key3 = 'a' LIMIT 1</code></li> <li>将上一步子查询的结果作为外层循环的条件</li></ul> <h4 id="相关标量子查询"><a href="#相关标量子查询" class="header-anchor">#</a> 相关标量子查询</h4> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> s1 <span class="token keyword">WHERE</span> 
    key1 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">SELECT</span> common_field <span class="token keyword">FROM</span> s2 <span class="token keyword">WHERE</span> s1<span class="token punctuation">.</span>key3 <span class="token operator">=</span> s2<span class="token punctuation">.</span>key3 <span class="token keyword">LIMIT</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><ul><li>从外循环取出一条记录</li> <li>获取上一步的记录所需的列，然后执行子查询</li> <li>如果符合条件，查出子查询的结果</li> <li>再将子查询的结果拼接到外层查询的WHERE子句中</li></ul> <h4 id="in子查询的优化"><a href="#in子查询的优化" class="header-anchor">#</a> IN子查询的优化</h4> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> s1 
    <span class="token keyword">WHERE</span> key1 <span class="token operator">IN</span> <span class="token punctuation">(</span><span class="token keyword">SELECT</span> common_field <span class="token keyword">FROM</span> s2 <span class="token keyword">WHERE</span> key3 <span class="token operator">=</span> <span class="token string">'a'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>将IN后面的子查询结果，写入到一个临时表中（物化表）<code>materialized_table</code></p> <p>那么就相当于有两张表，就有一下两种考虑</p> <ul><li>从原表<code>s1</code>的角度看待，先获取s1表中的一条记录，然后判断这条记录是否存在于物化表中。</li> <li>从物化表看待，先获取物化表中的值，然后判断s1表中是否有这个值的记录。</li></ul> <p>也就是说，可以相当于是一个内连接，等价于</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">SELECT</span> s1<span class="token punctuation">.</span><span class="token operator">*</span> <span class="token keyword">FROM</span> s1 <span class="token keyword">INNER</span> <span class="token keyword">JOIN</span> materialized_table <span class="token keyword">ON</span> key1 <span class="token operator">=</span> m_val<span class="token punctuation">;</span>
</code></pre></div><p>是内连接，那么优化器就会评估它们的连接顺序。</p> <h4 id="将子查询转换为semi-join"><a href="#将子查询转换为semi-join" class="header-anchor">#</a> 将子查询转换为semi-join</h4> <p><strong>直接将子查询转换为连接。</strong></p> <p>对于这样一个查询</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> s1 
    <span class="token keyword">WHERE</span> key1 <span class="token operator">IN</span> <span class="token punctuation">(</span><span class="token keyword">SELECT</span> common_field <span class="token keyword">FROM</span> s2 <span class="token keyword">WHERE</span> key3 <span class="token operator">=</span> <span class="token string">'a'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>尝试将其转换为连接</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">SELECT</span> s1<span class="token punctuation">.</span><span class="token operator">*</span> <span class="token keyword">FROM</span> s1 <span class="token keyword">INNER</span> <span class="token keyword">JOIN</span> s2 
    <span class="token keyword">ON</span> s1<span class="token punctuation">.</span>key1 <span class="token operator">=</span> s2<span class="token punctuation">.</span>common_field 
    <span class="token keyword">WHERE</span> s2<span class="token punctuation">.</span>key3 <span class="token operator">=</span> <span class="token string">'a'</span><span class="token punctuation">;</span>
</code></pre></div><p>这个查询的结果集是s1的记录，如果对于表s1的某条记录来说，s2表中有多条<code>s1.key1=s2.common_field</code>，那么s1的这条记录会加入多次到结果集中，这一种情况与原来的查询等价，原来的查询只关心是否存在记录满足<code>s1.key1=s2.common_field</code>二不关心具体有多少条记录与之匹配。</p> <p><strong>半连接</strong></p> <ul><li><p>Table pullout（子查询中的表上拉）</p> <p>当子查询的查询列表是只有主键或者唯一索引列时</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> s1 
    <span class="token keyword">WHERE</span> key2 <span class="token operator">IN</span> <span class="token punctuation">(</span><span class="token keyword">SELECT</span> key2 <span class="token keyword">FROM</span> s2 <span class="token keyword">WHERE</span> key3 <span class="token operator">=</span> <span class="token string">'a'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>可以转换为</p> <div class="language-SQL extra-class"><pre class="language-sql"><code><span class="token keyword">SELECT</span> s1<span class="token punctuation">.</span><span class="token operator">*</span> <span class="token keyword">FROM</span> s1 <span class="token keyword">INNER</span> <span class="token keyword">JOIN</span> s2 
    <span class="token keyword">ON</span> s1<span class="token punctuation">.</span>key2 <span class="token operator">=</span> s2<span class="token punctuation">.</span>key2 
    <span class="token keyword">WHERE</span> s2<span class="token punctuation">.</span>key3 <span class="token operator">=</span> <span class="token string">'a'</span><span class="token punctuation">;</span>
</code></pre></div><p>因为唯一索引或主键不存在有多条记录与之匹配</p></li> <li><p>DuplicateWeedout execution strategy （重复值消除）</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> s1 
    <span class="token keyword">WHERE</span> key1 <span class="token operator">IN</span> <span class="token punctuation">(</span><span class="token keyword">SELECT</span> common_field <span class="token keyword">FROM</span> s2 <span class="token keyword">WHERE</span> key3 <span class="token operator">=</span> <span class="token string">'a'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>可以创建一个临时表</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> tmp <span class="token punctuation">(</span>
    id <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>这样，如果要将s1的某条记录加入到结果集中，那先将该条记录的id插入到临时表中，如果插入成功，那可以将该条记录加入到结果集。</p></li></ul> <p><strong>半连接适用条件</strong></p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">SELECT</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token keyword">FROM</span> outer_tables 
    <span class="token keyword">WHERE</span> expr <span class="token operator">IN</span> <span class="token punctuation">(</span><span class="token keyword">SELECT</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token keyword">FROM</span> inner_tables <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span> <span class="token operator">AND</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
</code></pre></div><p>如果<code>IN</code>子查询不符合转换为<code>semi-join</code>的条件，那么查询优化器再二选一</p> <ul><li>先将子查询物化之后再执行查询</li> <li>执行<code>IN to EXISTS</code>转换</li></ul> <p><strong><code>IN to EXISTS</code>转换</strong></p> <div class="language-sql extra-class"><pre class="language-sql"><code>outer_expr <span class="token operator">IN</span> <span class="token punctuation">(</span><span class="token keyword">SELECT</span> inner_expr <span class="token keyword">FROM</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token keyword">WHERE</span> subquery_where<span class="token punctuation">)</span>
</code></pre></div><p>转换为</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">EXISTS</span> <span class="token punctuation">(</span><span class="token keyword">SELECT</span> inner_expr <span class="token keyword">FROM</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token keyword">WHERE</span> subquery_where <span class="token operator">AND</span> outer_expr<span class="token operator">=</span>inner_expr<span class="token punctuation">)</span>
</code></pre></div><p>转换为<code>EXISTS</code>的好处是，子查询可能可以用上索引</p> <p>看到这里脑子嗡嗡的~</p> <h2 id="第15章-explain详解"><a href="#第15章-explain详解" class="header-anchor">#</a> 第15章 EXPLAIN详解</h2> <p>一条查询语句在经过MySQL的查询优化器后，会基于成本或规则进行优化，可以通<code>EXPLAIN</code>来查看具体的执行计划。</p> <h3 id="执行输出中各列"><a href="#执行输出中各列" class="header-anchor">#</a> 执行输出中各列</h3> <div class="language-shell extra-class"><pre class="language-shell"><code>mysql<span class="token operator">&gt;</span> EXPLAIN SELECT * FROM s1<span class="token punctuation">;</span>
+----+-------------+-------+------------+------+---------------+------+---------+------+------+----------+-------+
<span class="token operator">|</span> <span class="token function">id</span> <span class="token operator">|</span> select_type <span class="token operator">|</span> table <span class="token operator">|</span> partitions <span class="token operator">|</span> <span class="token builtin class-name">type</span> <span class="token operator">|</span> possible_keys <span class="token operator">|</span> key  <span class="token operator">|</span> key_len <span class="token operator">|</span> ref  <span class="token operator">|</span> rows <span class="token operator">|</span> filtered <span class="token operator">|</span> Extra <span class="token operator">|</span>
+----+-------------+-------+------------+------+---------------+------+---------+------+------+----------+-------+
<span class="token operator">|</span>  <span class="token number">1</span> <span class="token operator">|</span> SIMPLE      <span class="token operator">|</span> s1    <span class="token operator">|</span> NULL       <span class="token operator">|</span> ALL  <span class="token operator">|</span> NULL          <span class="token operator">|</span> NULL <span class="token operator">|</span> NULL    <span class="token operator">|</span> NULL <span class="token operator">|</span> <span class="token number">9688</span> <span class="token operator">|</span>   <span class="token number">100.00</span> <span class="token operator">|</span> NULL  <span class="token operator">|</span>
+----+-------------+-------+------------+------+---------------+------+---------+------+------+----------+-------+
<span class="token number">1</span> row <span class="token keyword">in</span> set, <span class="token number">1</span> warning <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>
</code></pre></div><h4 id="table"><a href="#table" class="header-anchor">#</a> table</h4> <p>无论查询语句中包含多少个表，最终都会对每个表进行单表查询</p> <h4 id="id"><a href="#id" class="header-anchor">#</a> id</h4> <p>一个大的查询可以拆分成多个<code>SELECT</code>，每一个<code>SELECT</code>对应一个id。</p> <p>对于连接查询因为是同一个<code>SELECT</code>子句，所以查询的两个表是同一个id值。</p> <div class="language-shell extra-class"><pre class="language-shell"><code>mysql<span class="token operator">&gt;</span> EXPLAIN SELECT * FROM s1 INNER JOIN s2<span class="token punctuation">;</span>
+----+-------------+-------+------------+------+---------------+------+---------+------+------+----------+---------------------------------------+
<span class="token operator">|</span> <span class="token function">id</span> <span class="token operator">|</span> select_type <span class="token operator">|</span> table <span class="token operator">|</span> partitions <span class="token operator">|</span> <span class="token builtin class-name">type</span> <span class="token operator">|</span> possible_keys <span class="token operator">|</span> key  <span class="token operator">|</span> key_len <span class="token operator">|</span> ref  <span class="token operator">|</span> rows <span class="token operator">|</span> filtered <span class="token operator">|</span> Extra                                 <span class="token operator">|</span>
+----+-------------+-------+------------+------+---------------+------+---------+------+------+----------+---------------------------------------+
<span class="token operator">|</span>  <span class="token number">1</span> <span class="token operator">|</span> SIMPLE      <span class="token operator">|</span> s1    <span class="token operator">|</span> NULL       <span class="token operator">|</span> ALL  <span class="token operator">|</span> NULL          <span class="token operator">|</span> NULL <span class="token operator">|</span> NULL    <span class="token operator">|</span> NULL <span class="token operator">|</span> <span class="token number">9688</span> <span class="token operator">|</span>   <span class="token number">100.00</span> <span class="token operator">|</span> NULL                                  <span class="token operator">|</span>
<span class="token operator">|</span>  <span class="token number">1</span> <span class="token operator">|</span> SIMPLE      <span class="token operator">|</span> s2    <span class="token operator">|</span> NULL       <span class="token operator">|</span> ALL  <span class="token operator">|</span> NULL          <span class="token operator">|</span> NULL <span class="token operator">|</span> NULL    <span class="token operator">|</span> NULL <span class="token operator">|</span> <span class="token number">9954</span> <span class="token operator">|</span>   <span class="token number">100.00</span> <span class="token operator">|</span> Using <span class="token function">join</span> buffer <span class="token punctuation">(</span>Block Nested Loop<span class="token punctuation">)</span> <span class="token operator">|</span>
+----+-------------+-------+------------+------+---------------+------+---------+------+------+----------+---------------------------------------+
<span class="token number">2</span> rows <span class="token keyword">in</span> set, <span class="token number">1</span> warning <span class="token punctuation">(</span><span class="token number">0.01</span> sec<span class="token punctuation">)</span>
</code></pre></div><p>对于联合查询或者子查询，则会分配多个唯一id值。</p> <div class="language-shell extra-class"><pre class="language-shell"><code>mysql<span class="token operator">&gt;</span> EXPLAIN SELECT * FROM s1 WHERE key1 IN <span class="token punctuation">(</span>SELECT key1 FROM s2<span class="token punctuation">)</span> OR key3 <span class="token operator">=</span> <span class="token string">'a'</span><span class="token punctuation">;</span>
+----+-------------+-------+------------+-------+---------------+----------+---------+------+------+----------+-------------+
<span class="token operator">|</span> <span class="token function">id</span> <span class="token operator">|</span> select_type <span class="token operator">|</span> table <span class="token operator">|</span> partitions <span class="token operator">|</span> <span class="token builtin class-name">type</span>  <span class="token operator">|</span> possible_keys <span class="token operator">|</span> key      <span class="token operator">|</span> key_len <span class="token operator">|</span> ref  <span class="token operator">|</span> rows <span class="token operator">|</span> filtered <span class="token operator">|</span> Extra       <span class="token operator">|</span>
+----+-------------+-------+------------+-------+---------------+----------+---------+------+------+----------+-------------+
<span class="token operator">|</span>  <span class="token number">1</span> <span class="token operator">|</span> PRIMARY     <span class="token operator">|</span> s1    <span class="token operator">|</span> NULL       <span class="token operator">|</span> ALL   <span class="token operator">|</span> idx_key3      <span class="token operator">|</span> NULL     <span class="token operator">|</span> NULL    <span class="token operator">|</span> NULL <span class="token operator">|</span> <span class="token number">9688</span> <span class="token operator">|</span>   <span class="token number">100.00</span> <span class="token operator">|</span> Using where <span class="token operator">|</span>
<span class="token operator">|</span>  <span class="token number">2</span> <span class="token operator">|</span> SUBQUERY    <span class="token operator">|</span> s2    <span class="token operator">|</span> NULL       <span class="token operator">|</span> index <span class="token operator">|</span> idx_key1      <span class="token operator">|</span> idx_key1 <span class="token operator">|</span> <span class="token number">303</span>     <span class="token operator">|</span> NULL <span class="token operator">|</span> <span class="token number">9954</span> <span class="token operator">|</span>   <span class="token number">100.00</span> <span class="token operator">|</span> Using index <span class="token operator">|</span>
+----+-------------+-------+------------+-------+---------------+----------+---------+------+------+----------+-------------+
<span class="token number">2</span> rows <span class="token keyword">in</span> set, <span class="token number">1</span> warning <span class="token punctuation">(</span><span class="token number">0.02</span> sec<span class="token punctuation">)</span>
</code></pre></div><h4 id="select-type"><a href="#select-type" class="header-anchor">#</a> select_type</h4> <p>一个大的<code>SELECT</code>可以拆分成多个小<code>SELECT</code>，对每一个`SELECT分配角色。</p> <ul><li>SIMPLE</li></ul> <p>不包含<code>UNION</code>或者子查询的查询都算作<code>SIMPLE</code>类型</p> <div class="language-shell extra-class"><pre class="language-shell"><code>mysql<span class="token operator">&gt;</span> EXPLAIN SELECT * FROM s1<span class="token punctuation">;</span>
+----+-------------+-------+------------+------+---------------+------+---------+------+------+----------+-------+
<span class="token operator">|</span> <span class="token function">id</span> <span class="token operator">|</span> select_type <span class="token operator">|</span> table <span class="token operator">|</span> partitions <span class="token operator">|</span> <span class="token builtin class-name">type</span> <span class="token operator">|</span> possible_keys <span class="token operator">|</span> key  <span class="token operator">|</span> key_len <span class="token operator">|</span> ref  <span class="token operator">|</span> rows <span class="token operator">|</span> filtered <span class="token operator">|</span> Extra <span class="token operator">|</span>
+----+-------------+-------+------------+------+---------------+------+---------+------+------+----------+-------+
<span class="token operator">|</span>  <span class="token number">1</span> <span class="token operator">|</span> SIMPLE      <span class="token operator">|</span> s1    <span class="token operator">|</span> NULL       <span class="token operator">|</span> ALL  <span class="token operator">|</span> NULL          <span class="token operator">|</span> NULL <span class="token operator">|</span> NULL    <span class="token operator">|</span> NULL <span class="token operator">|</span> <span class="token number">9688</span> <span class="token operator">|</span>   <span class="token number">100.00</span> <span class="token operator">|</span> NULL  <span class="token operator">|</span>
+----+-------------+-------+------------+------+---------------+------+---------+------+------+----------+-------+
<span class="token number">1</span> row <span class="token keyword">in</span> set, <span class="token number">1</span> warning <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>
</code></pre></div><ul><li>PRIVATE</li></ul> <p>包含<code>UNION</code>，或者子查询的查询，其中最左边的表就是<code>PRIVATE</code></p> <div class="language-shell extra-class"><pre class="language-shell"><code>mysql<span class="token operator">&gt;</span> EXPLAIN SELECT * FROM s1 UNION SELECT * FROM s2<span class="token punctuation">;</span>
+----+--------------+------------+------------+------+---------------+------+---------+------+------+----------+-----------------+
<span class="token operator">|</span> <span class="token function">id</span> <span class="token operator">|</span> select_type  <span class="token operator">|</span> table      <span class="token operator">|</span> partitions <span class="token operator">|</span> <span class="token builtin class-name">type</span> <span class="token operator">|</span> possible_keys <span class="token operator">|</span> key  <span class="token operator">|</span> key_len <span class="token operator">|</span> ref  <span class="token operator">|</span> rows <span class="token operator">|</span> filtered <span class="token operator">|</span> Extra           <span class="token operator">|</span>
+----+--------------+------------+------------+------+---------------+------+---------+------+------+----------+-----------------+
<span class="token operator">|</span>  <span class="token number">1</span> <span class="token operator">|</span> PRIMARY      <span class="token operator">|</span> s1         <span class="token operator">|</span> NULL       <span class="token operator">|</span> ALL  <span class="token operator">|</span> NULL          <span class="token operator">|</span> NULL <span class="token operator">|</span> NULL    <span class="token operator">|</span> NULL <span class="token operator">|</span> <span class="token number">9688</span> <span class="token operator">|</span>   <span class="token number">100.00</span> <span class="token operator">|</span> NULL            <span class="token operator">|</span>
<span class="token operator">|</span>  <span class="token number">2</span> <span class="token operator">|</span> UNION        <span class="token operator">|</span> s2         <span class="token operator">|</span> NULL       <span class="token operator">|</span> ALL  <span class="token operator">|</span> NULL          <span class="token operator">|</span> NULL <span class="token operator">|</span> NULL    <span class="token operator">|</span> NULL <span class="token operator">|</span> <span class="token number">9954</span> <span class="token operator">|</span>   <span class="token number">100.00</span> <span class="token operator">|</span> NULL            <span class="token operator">|</span>
<span class="token operator">|</span> NULL <span class="token operator">|</span> UNION RESULT <span class="token operator">|</span> <span class="token operator">&lt;</span>union1,<span class="token operator"><span class="token file-descriptor important">2</span>&gt;</span> <span class="token operator">|</span> NULL       <span class="token operator">|</span> ALL  <span class="token operator">|</span> NULL          <span class="token operator">|</span> NULL <span class="token operator">|</span> NULL    <span class="token operator">|</span> NULL <span class="token operator">|</span> NULL <span class="token operator">|</span>     NULL <span class="token operator">|</span> Using temporary <span class="token operator">|</span>
+----+--------------+------------+------------+------+---------------+------+---------+------+------+----------+-----------------+
<span class="token number">3</span> rows <span class="token keyword">in</span> set, <span class="token number">1</span> warning <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>
</code></pre></div><ul><li>UNION</li></ul> <p>上边，除了最左边的s1，其它都是<code>UNION</code></p> <ul><li>UNION RESULT</li></ul> <p>上边，需要将两个查询的结果集合并，这里就是存放到一个临时表中，并去重。</p> <ul><li>SUBQUERY</li></ul> <p>包含子查询的查询，不能转为对应的<code>semi-join</code>，并且是不相关子查询</p> <ul><li>DEPENDENT SUBQUERY</li></ul> <p>相关子查询</p> <ul><li>DEPENDENT UNION</li> <li>DERIVED</li></ul> <p>派生表</p> <div class="language-shell extra-class"><pre class="language-shell"><code>mysql<span class="token operator">&gt;</span> EXPLAIN SELECT * FROM <span class="token punctuation">(</span>SELECT key1, count<span class="token punctuation">(</span>*<span class="token punctuation">)</span> as c FROM s1 GROUP BY key1<span class="token punctuation">)</span> AS derived_s1 where c <span class="token operator">&gt;</span> <span class="token number">1</span><span class="token punctuation">;</span>
+----+-------------+------------+------------+-------+---------------+----------+---------+------+------+----------+-------------+
<span class="token operator">|</span> <span class="token function">id</span> <span class="token operator">|</span> select_type <span class="token operator">|</span> table      <span class="token operator">|</span> partitions <span class="token operator">|</span> <span class="token builtin class-name">type</span>  <span class="token operator">|</span> possible_keys <span class="token operator">|</span> key      <span class="token operator">|</span> key_len <span class="token operator">|</span> ref  <span class="token operator">|</span> rows <span class="token operator">|</span> filtered <span class="token operator">|</span> Extra       <span class="token operator">|</span>
+----+-------------+------------+------------+-------+---------------+----------+---------+------+------+----------+-------------+
<span class="token operator">|</span>  <span class="token number">1</span> <span class="token operator">|</span> PRIMARY     <span class="token operator">|</span> <span class="token operator">&lt;</span>derived<span class="token operator"><span class="token file-descriptor important">2</span>&gt;</span> <span class="token operator">|</span> NULL       <span class="token operator">|</span> ALL   <span class="token operator">|</span> NULL          <span class="token operator">|</span> NULL     <span class="token operator">|</span> NULL    <span class="token operator">|</span> NULL <span class="token operator">|</span> <span class="token number">9688</span> <span class="token operator">|</span>    <span class="token number">33.33</span> <span class="token operator">|</span> Using where <span class="token operator">|</span>
<span class="token operator">|</span>  <span class="token number">2</span> <span class="token operator">|</span> DERIVED     <span class="token operator">|</span> s1         <span class="token operator">|</span> NULL       <span class="token operator">|</span> index <span class="token operator">|</span> idx_key1      <span class="token operator">|</span> idx_key1 <span class="token operator">|</span> <span class="token number">303</span>     <span class="token operator">|</span> NULL <span class="token operator">|</span> <span class="token number">9688</span> <span class="token operator">|</span>   <span class="token number">100.00</span> <span class="token operator">|</span> Using index <span class="token operator">|</span>
+----+-------------+------------+------------+-------+---------------+----------+---------+------+------+----------+-------------+
<span class="token number">2</span> rows <span class="token keyword">in</span> set, <span class="token number">1</span> warning <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>
</code></pre></div><ul><li>MATERIALIZED</li></ul> <p>物化表</p> <div class="language-shell extra-class"><pre class="language-shell"><code>mysql<span class="token operator">&gt;</span> EXPLAIN SELECT * FROM s1 WHERE key1 IN <span class="token punctuation">(</span>SELECT key1 FROM s2<span class="token punctuation">)</span><span class="token punctuation">;</span>
+----+--------------+-------------+------------+--------+---------------+------------+---------+-------------------+------+----------+-------------+
<span class="token operator">|</span> <span class="token function">id</span> <span class="token operator">|</span> select_type  <span class="token operator">|</span> table       <span class="token operator">|</span> partitions <span class="token operator">|</span> <span class="token builtin class-name">type</span>   <span class="token operator">|</span> possible_keys <span class="token operator">|</span> key        <span class="token operator">|</span> key_len <span class="token operator">|</span> ref               <span class="token operator">|</span> rows <span class="token operator">|</span> filtered <span class="token operator">|</span> Extra       <span class="token operator">|</span>
+----+--------------+-------------+------------+--------+---------------+------------+---------+-------------------+------+----------+-------------+
<span class="token operator">|</span>  <span class="token number">1</span> <span class="token operator">|</span> SIMPLE       <span class="token operator">|</span> s1          <span class="token operator">|</span> NULL       <span class="token operator">|</span> ALL    <span class="token operator">|</span> idx_key1      <span class="token operator">|</span> NULL       <span class="token operator">|</span> NULL    <span class="token operator">|</span> NULL              <span class="token operator">|</span> <span class="token number">9688</span> <span class="token operator">|</span>   <span class="token number">100.00</span> <span class="token operator">|</span> Using where <span class="token operator">|</span>
<span class="token operator">|</span>  <span class="token number">1</span> <span class="token operator">|</span> SIMPLE       <span class="token operator">|</span> <span class="token operator">&lt;</span>subquery<span class="token operator"><span class="token file-descriptor important">2</span>&gt;</span> <span class="token operator">|</span> NULL       <span class="token operator">|</span> eq_ref <span class="token operator">|</span> <span class="token operator">&lt;</span>auto_key<span class="token operator">&gt;</span>    <span class="token operator">|</span> <span class="token operator">&lt;</span>auto_key<span class="token operator">&gt;</span> <span class="token operator">|</span> <span class="token number">303</span>     <span class="token operator">|</span> xiaohaizi.s1.key1 <span class="token operator">|</span>    <span class="token number">1</span> <span class="token operator">|</span>   <span class="token number">100.00</span> <span class="token operator">|</span> NULL        <span class="token operator">|</span>
<span class="token operator">|</span>  <span class="token number">2</span> <span class="token operator">|</span> MATERIALIZED <span class="token operator">|</span> s2          <span class="token operator">|</span> NULL       <span class="token operator">|</span> index  <span class="token operator">|</span> idx_key1      <span class="token operator">|</span> idx_key1   <span class="token operator">|</span> <span class="token number">303</span>     <span class="token operator">|</span> NULL              <span class="token operator">|</span> <span class="token number">9954</span> <span class="token operator">|</span>   <span class="token number">100.00</span> <span class="token operator">|</span> Using index <span class="token operator">|</span>
+----+--------------+-------------+------------+--------+---------------+------------+---------+-------------------+------+----------+-------------+
<span class="token number">3</span> rows <span class="token keyword">in</span> set, <span class="token number">1</span> warning <span class="token punctuation">(</span><span class="token number">0.01</span> sec<span class="token punctuation">)</span>
</code></pre></div><h4 id="type"><a href="#type" class="header-anchor">#</a> type</h4> <table><thead><tr><th>type</th> <th>类型</th></tr></thead> <tbody><tr><td>system</td> <td>对于统计精确的引擎，表中仅含一条记录</td></tr> <tr><td>const</td> <td>单表访问，主键或者唯一二级索引列与等值匹配</td></tr> <tr><td>eq_ref</td> <td>连接查询，被驱动表通过主键或者唯一二级索引列与等值匹配</td></tr> <tr><td>ref</td> <td>普通的二级索引列与等值匹配</td></tr> <tr><td>fulltext</td> <td>全文索引</td></tr> <tr><td>ref_or_null</td> <td>普通的二级索引列与等值匹配，包含NULL</td></tr> <tr><td>index_merge</td> <td>索引合并</td></tr> <tr><td>unique_subquery</td> <td>连接查询，被驱动表使用eq_ref</td></tr> <tr><td>index_subquery</td> <td>连接查询，被驱动表使用ref</td></tr> <tr><td>range</td> <td>使用索引获取某些范围区间</td></tr> <tr><td>index</td> <td>需要扫描索引上的所有数据</td></tr> <tr><td>ALL</td> <td>全表扫描</td></tr></tbody></table> <h4 id="possible-keys和key"><a href="#possible-keys和key" class="header-anchor">#</a> possible_keys和key</h4> <p>可能使用到的索引，和实际用到的索引</p> <h4 id="key-len"><a href="#key-len" class="header-anchor">#</a> key_len</h4> <h4 id="ref"><a href="#ref" class="header-anchor">#</a> ref</h4> <p>使用索引列等值匹配去执行查询时，展示与什么进行等值匹配，与某个常数const，某一列，某个函数。</p> <h4 id="rows"><a href="#rows" class="header-anchor">#</a> rows</h4> <p>预计需要扫描的行数</p> <h4 id="filtered"><a href="#filtered" class="header-anchor">#</a> filtered</h4> <p>过滤条件后，还剩多少记录，1~100%。</p> <p><strong>未完待续。。。</strong></p> <h2 id="第16章-optimizer-trace的神奇功效"><a href="#第16章-optimizer-trace的神奇功效" class="header-anchor">#</a> 第16章 optimizer trace的神奇功效</h2> <h2 id="第17章-innodb的buffer-pool"><a href="#第17章-innodb的buffer-pool" class="header-anchor">#</a> 第17章 InnoDB的Buffer Pool</h2> <p>磁盘太慢，用内存作为缓存，不至于每次都访问磁盘。</p> <p>Buffer Poll是向操作系统申请的连续内存，一个个的chunk组成，每个chunk由<code>控制块</code>和<code>缓存页</code>组成，控制块那肯定就是存放一些缓存页的信息，上一页，下一页，锁啥的。</p> <p>那在内存中弄了一个这样的玩意，那肯定就有这些问题</p> <p>咋知道缓存中是否加载了某一页，使用<code>表空间号 + 页号</code>作为<code>key</code>，缓存页作为<code>value</code>，建立哈希表。</p> <p>缓存中修改了页（<code>脏页</code>），加入到flush链表，等待时机刷入磁盘。</p> <p>Buffer Poll满了怎么办，采用LRU链表，LRU链表分为young区和old区，新加入的数据，放到LRU的old头，在间隔一定时间外访问，就会吧他送到young头。没有足够的空闲缓存页，首先淘汰old中的页。</p> <p>少于1G缓存数据，不建议搞多个Buffer Poll。</p> <h2 id="第18章-事务"><a href="#第18章-事务" class="header-anchor">#</a> 第18章 事务</h2> <p>ACID，原子性，一致性，隔离性，持久性</p> <h2 id="第19章-redo日志"><a href="#第19章-redo日志" class="header-anchor">#</a> 第19章 redo日志</h2> <h2 id="第20章-undo日志"><a href="#第20章-undo日志" class="header-anchor">#</a> 第20章 undo日志</h2> <h2 id="第21章-事务隔离级别和mvcc"><a href="#第21章-事务隔离级别和mvcc" class="header-anchor">#</a> 第21章 事务隔离级别和MVCC</h2> <h2 id="第22章-锁"><a href="#第22章-锁" class="header-anchor">#</a> 第22章 锁</h2></div></div>  <div class="page-edit"><!----> <!----> <!----></div> <div class="page-nav-wapper"><div class="page-nav-centre-wrap"><a href="/pages/c7801c/" class="page-nav-centre page-nav-centre-prev"><div class="tooltip">MySQL基础</div></a> <a href="/pages/e60c12/" class="page-nav-centre page-nav-centre-next"><div class="tooltip">MySQL函数</div></a></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/pages/c7801c/" class="prev">MySQL基础</a></span> <span class="next"><a href="/pages/e60c12/">MySQL函数</a>→
      </span></p></div></div></div> <div class="article-list"><div class="article-title"><a href="/archives" class="iconfont icon-bi">最近更新</a></div> <div class="article-wrapper"><dl><dd>01</dd> <dt><a href="/pages/4ce008/"><div>
            Controller接收请求方式
            <!----></div></a> <span class="date">08-10</span></dt></dl><dl><dd>02</dd> <dt><a href="/pages/7d963b/"><div>
            面试记录
            <!----></div></a> <span class="date">07-27</span></dt></dl><dl><dd>03</dd> <dt><a href="/pages/20b125/"><div>
            分布式共识Raft算法
            <!----></div></a> <span class="date">07-12</span></dt></dl> <dl><dd></dd> <dt><a href="/archives" class="more">更多文章&gt;</a></dt></dl></div></div></main></div> <div class="footer"><div class="icons"><a href="mailto:895827938@qq.com" title="发邮件" target="_blank" class="iconfont icon-youjian"></a><a href="https://github.com/lzxiaohuihui" title="GitHub" target="_blank" class="iconfont icon-github"></a><a href="https://music.163.com/#/playlist?id=782007907" title="听音乐" target="_blank" class="iconfont icon-erji"></a></div> 
  Theme by
  <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" title="本站主题">Vdoing</a> 
    | Copyright © 2023-2023
    <span>Evan Xu | MIT License</span></div> <div class="buttons"><div title="返回顶部" class="button blur go-to-top iconfont icon-fanhuidingbu" style="display:none;"></div> <div title="去评论" class="button blur go-to-comment iconfont icon-pinglun" style="display:none;"></div> <div title="主题模式" class="button blur theme-mode-but iconfont icon-zhuti"><ul class="select-box" style="display:none;"><li class="iconfont icon-zidong">
          跟随系统
        </li><li class="iconfont icon-rijianmoshi">
          浅色模式
        </li><li class="iconfont icon-yejianmoshi">
          深色模式
        </li><li class="iconfont icon-yuedu">
          阅读模式
        </li></ul></div></div> <!----> <!----> <!----></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.346e1551.js" defer></script><script src="/assets/js/2.2bb1a3f0.js" defer></script><script src="/assets/js/28.4cd79971.js" defer></script>
  </body>
</html>
