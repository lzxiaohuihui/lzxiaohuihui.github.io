(window.webpackJsonp=window.webpackJsonp||[]).push([[85],{415:function(t,a,s){"use strict";s.r(a);var n=s(3),e=Object(n.a)({},(function(){var t=this,a=t._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("p",[t._v("稀疏重建入口")]),t._v(" "),a("h2",{attrs:{id:"runsparsemapper"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#runsparsemapper"}},[t._v("#")]),t._v(" RunSparseMapper")]),t._v(" "),a("div",{staticClass:"language-cpp extra-class"},[a("pre",{pre:!0,attrs:{class:"language-cpp"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("AutomaticReconstructionController")]),a("span",{pre:!0,attrs:{class:"token double-colon punctuation"}},[t._v("::")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("RunSparseMapper")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("auto")]),t._v(" sparse_path "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("JoinPaths")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("options_"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("workspace_path"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"sparse"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("ExistsDir")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("sparse_path"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("auto")]),t._v(" dir_list "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("GetDirList")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("sparse_path"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    std"),a("span",{pre:!0,attrs:{class:"token double-colon punctuation"}},[t._v("::")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("sort")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("dir_list"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("begin")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" dir_list"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("end")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("dir_list"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("size")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      std"),a("span",{pre:!0,attrs:{class:"token double-colon punctuation"}},[t._v("::")]),t._v("cout "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" std"),a("span",{pre:!0,attrs:{class:"token double-colon punctuation"}},[t._v("::")]),t._v("endl\n                "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"WARNING: Skipping sparse reconstruction because it is "')]),t._v("\n                   "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"already computed"')]),t._v("\n                "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" std"),a("span",{pre:!0,attrs:{class:"token double-colon punctuation"}},[t._v("::")]),t._v("endl"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("auto")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&")]),t._v(" dir "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" dir_list"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        reconstruction_manager_"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("->")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("Read")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("dir"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n  IncrementalMapperController "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("mapper")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n      option_manager_"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("mapper"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("get")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("option_manager_"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("image_path"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("option_manager_"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("database_path"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" reconstruction_manager_"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  active_thread_ "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&")]),t._v("mapper"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  mapper"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("Start")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  mapper"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("Wait")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  active_thread_ "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("nullptr")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("CreateDirIfNotExists")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("sparse_path"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  reconstruction_manager_"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("->")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("Write")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("sparse_path"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&")]),t._v("option_manager_"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[a("strong",[t._v("Image")])]),t._v(" "),a("p",[t._v("与另一幅图像至少有一个对应关系的 2D 点数。"),a("code",[t._v("num_observations")])]),t._v(" "),a("p",[t._v("与其它图像的关联总数"),a("code",[t._v("num_correspondences")])]),t._v(" "),a("p",[t._v("图像的每个特征点都有一个vector，由于存放与该特征点匹配的track（image_id, point2D_id）")]),t._v(" "),a("p",[a("code",[t._v("std::vector<std::vector<Correspondence>> corrs;")])]),t._v(" "),a("p",[t._v("遍历所有的边，更新corrs")]),t._v(" "),a("h3",{attrs:{id:"findnext"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#findnext"}},[t._v("#")]),t._v(" FindNext")]),t._v(" "),a("p",[t._v("将所有未注册的图像，按照某种得分策略排序")]),t._v(" "),a("ul",[a("li",[t._v("图像的可见3D点，2D-3D关联")]),t._v(" "),a("li",[t._v("图像的可见3D点比率")]),t._v(" "),a("li",[t._v("论文中的next best view策略")])]),t._v(" "),a("p",[a("code",[t._v("vector<image_t> next_images")])]),t._v(" "),a("h3",{attrs:{id:"registernextimage"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#registernextimage"}},[t._v("#")]),t._v(" RegisterNextImage")]),t._v(" "),a("p",[t._v("遍历"),a("code",[t._v("vector<image_t> next_images")]),t._v("，如果成功了就break")]),t._v(" "),a("p",[t._v("寻找2D-3D点的关联")]),t._v(" "),a("h3",{attrs:{id:"estimateabsolutepose"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#estimateabsolutepose"}},[t._v("#")]),t._v(" EstimateAbsolutePose")]),t._v(" "),a("p",[t._v("对于不同的focal_length_factors，都进行一次位姿估计，最终选择内点数最多的估计")]),t._v(" "),a("h3",{attrs:{id:"refineabsolutepose"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#refineabsolutepose"}},[t._v("#")]),t._v(" RefineAbsolutePose")]),t._v(" "),a("p",[t._v("对当前帧观测到的3D点进行BA一次")]),t._v(" "),a("h3",{attrs:{id:"triangulateimage"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#triangulateimage"}},[t._v("#")]),t._v(" TriangulateImage")]),t._v(" "),a("p",[t._v("生成新的观测")]),t._v(" "),a("h3",{attrs:{id:"iterativelocalrefinement"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#iterativelocalrefinement"}},[t._v("#")]),t._v(" IterativeLocalRefinement")]),t._v(" "),a("p",[t._v("对改变了的观测进行一次BA")]),t._v(" "),a("h3",{attrs:{id:"iterativeglobalrefinement"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#iterativeglobalrefinement"}},[t._v("#")]),t._v(" IterativeGlobalRefinement")]),t._v(" "),a("p",[t._v("如果模型增长一定比率，则进行全局BA")]),t._v(" "),a("p",[t._v("对已经配准的图像对，重新进行一次三角化")])])}),[],!1,null,null,null);a.default=e.exports}}]);